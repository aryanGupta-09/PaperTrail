<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data from Sources</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            box-sizing: border-box;
        }
        button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        #feedback {
            margin-top: 10px;
            font-size: 14px;
        }
        #feedback.loading {
            color: orange;
        }
        #feedback.success {
            color: green;
        }
        #feedback.error {
            color: red;
        }
    </style>
</head>
<body>

<h1>Integrated Research Data</h1>

<!-- Search Bar and Button -->
<div>
    <input type="text" id="search-bar" placeholder="Search..." />
    <button id="search-button" onclick="handleButtonClick()">Search</button>
    <p id="feedback"></p>
</div>

<!-- Integrated Data Table -->
<h2>Integrated Data Table</h2>
<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Snippet</th>
            <th>Authors</th>
            <th>Year</th>
            <th>Link</th>
        </tr>
    </thead>
    <tbody id="combined-results"></tbody>
</table>

<!-- Raw Data Tables -->
<h2>Raw Data Tables</h2>

<!-- SerpAPI Results Table -->
<h3>SerpAPI Results</h3>
<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Snippet</th>
            <th>Authors</th>
            <th>Year</th>
            <th>Link</th>
        </tr>
    </thead>
    <tbody id="serpapi-results"></tbody>
</table>

<!-- DBLP Results Table -->
<h3>DBLP Results</h3>
<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Authors</th>
            <th>Year</th>
            <th>Link</th>
        </tr>
    </thead>
    <tbody id="dblp-results"></tbody>
</table>

<!-- arXiv Results Table -->
<h3>arXiv Results</h3>
<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Summary</th>
            <th>Authors</th>
            <th>Published Date</th>
            <th>Link</th>
        </tr>
    </thead>
    <tbody id="arxiv-results"></tbody>
</table>

<script>
    function handleButtonClick() {
        const query = document.getElementById("search-bar").value.trim(); 
        if (query) {
            fetch(`/fetch-data/json?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => updateResults(data))
                .catch(error => {
                    console.error("Error:", error);
                    const feedbackElement = document.getElementById('feedback');
                    feedbackElement.textContent = "An error occurred while fetching data.";
                    feedbackElement.className = "error";
                });
        } else {
            const feedbackElement = document.getElementById('feedback');
            feedbackElement.textContent = "Please enter a search term.";
            feedbackElement.className = "error";
        }
    }

    function updateResults(data) {
        // Feedback message
        const feedbackElement = document.getElementById('feedback');
        feedbackElement.textContent = "Data fetched successfully!";
        feedbackElement.className = "success";

        // Update Combined Results Table
        const combinedTableBody = document.querySelector("#combined-results");
        combinedTableBody.innerHTML = "";
        if (data.combined_results?.length) {
            data.combined_results.forEach(result => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${result.title || "Unknown"}</td>
                    <td>${result.snippet || "No snippet available"}</td>
                    <td>${result.authors || "Unknown"}</td>
                    <td>${result.year || "Unknown"}</td>
                    <td><a href="${result.link}" target="_blank">View</a></td>
                `;
                combinedTableBody.appendChild(row);
            });
        } else {
            combinedTableBody.innerHTML = "<tr><td colspan='5'>No results found</td></tr>";
        }

        // Update SerpAPI Results Table
        const serpapiTableBody = document.querySelector("#serpapi-results");
        serpapiTableBody.innerHTML = "";
        
        if (data.serpapi_results?.length) {
            data.serpapi_results.forEach(result => {
                const summary = result.publication_info?.summary || "";
                const authors = summary.split("-")[0]?.trim()?.split(",").map(a => a.trim()).join(", ") || "Unknown";
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${result.title || "Unknown"}</td>
                    <td>${result.snippet || "No snippet available"}</td>
                    <td>${authors}</td>
                    <td>${result.publication_info?.summary?.match(/\b(19|20)\d{2}\b/)?.[0] || "Unknown"}</td>
                    <td><a href="${result.link}" target="_blank">View</a></td>
                `;
                serpapiTableBody.appendChild(row);
            });
        } else {
            serpapiTableBody.innerHTML = "<tr><td colspan='5'>No results found</td></tr>";
        }

        // Update DBLP Results Table
        const dblpTableBody = document.querySelector("#dblp-results");
        dblpTableBody.innerHTML = "";
        if (data.dblp_results?.length) {
            data.dblp_results.forEach(result => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${result.info.title || "Unknown Title"}</td>
                    <td>${Array.isArray(result.info.authors?.author)
                        ? result.info.authors.author.map(a => a.text).join(", ")
                        : result.info.authors?.author?.text || "Unknown authors"}</td>
                    <td>${result.info.year || "N/A"}</td>
                    <td><a href="${result.info.url}" target="_blank">View</a></td>
                `;
                dblpTableBody.appendChild(row);
            });
        } else {
            dblpTableBody.innerHTML = "<tr><td colspan='4'>No results found</td></tr>";
        }

        // Update arXiv Results Table
        const arxivTableBody = document.querySelector("#arxiv-results");
        arxivTableBody.innerHTML = "";
        if (data.arXiv_results?.length) {
            data.arXiv_results.forEach(result => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${result.title || "Unknown Title"}</td>
                    <td>${result.summary || "No summary available"}</td>
                    <td>${Array.isArray(result.author) 
                        ? result.author.map(a => a.name).join(", ") 
                        : result.author?.name || "Unknown authors"}</td>
                    <td>${result.published?.slice(0, 10) || "Unknown Date"}</td>
                    <td><a href="${result.id}" target="_blank">View</a></td>
                `;
                arxivTableBody.appendChild(row);
            });
        } else {
            arxivTableBody.innerHTML = "<tr><td colspan='5'>No results found</td></tr>";
        }
    }
</script>

</body>
</html>
